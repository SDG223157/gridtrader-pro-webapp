{% extends "base_simple.html" %}

{% block title %}Analytics - GridTrader Pro{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">Analytics</h1>
    
    <!-- Portfolio Summary Cards -->
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-8">
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                            <i class="fas fa-chart-pie text-white"></i>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Total Performance</dt>
                            <dd class="text-lg font-medium text-gray-900">Coming Soon</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Active Strategies</dt>
                            <dd class="text-lg font-medium text-gray-900">Coming Soon</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center">
                            <i class="fas fa-shield-alt text-white"></i>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Risk Metrics</dt>
                            <dd class="text-lg font-medium text-gray-900">Coming Soon</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Market Overview with TradingView S&P 500 -->
    <div class="bg-white shadow rounded-lg mb-8">
        <div class="px-4 py-5 sm:p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Market Overview</h3>
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                    <span class="text-sm text-gray-600">Live S&P 500</span>
                    <button onclick="window.location.reload()" class="ml-3 text-blue-600 hover:text-blue-800">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
            
            <!-- TradingView AAPL Widget -->
            <div id="tradingview_widget_container" style="height: 500px; width: 100%;">
                <div id="tradingview_aapl_chart" style="height: 100%; width: 100%;"></div>
            </div>
            <div class="mt-2 text-center">
                <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank" class="text-xs text-gray-500">
                    AAPL powered by TradingView
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize TradingView AAPL Widget
function initAAPLTradingViewWidget() {
    try {
        console.log('üçé Initializing AAPL TradingView widget...');
        
        new TradingView.widget({
            "autosize": true,
            "symbol": "NASDAQ:AAPL",
            "interval": "D",
            "timezone": "America/New_York",
            "theme": "light",
            "style": "1",
            "locale": "en",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_aapl_chart",
            "studies": [
                "Volume@tv-basicstudies",
                "MASimple@tv-basicstudies"
            ],
            "show_popup_button": true,
            "popup_width": "1000",
            "popup_height": "650",
            "details": true,
            "calendar": false
        });
        
        console.log('‚úÖ AAPL TradingView widget initialized successfully');
        
    } catch (error) {
        console.error('‚ùå Error initializing AAPL TradingView widget:', error);
        
        // Fallback: show error message
        const container = document.getElementById('tradingview_aapl_chart');
        if (container) {
            container.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500"><div class="text-center"><i class="fas fa-chart-line text-4xl mb-4"></i><p>Chart temporarily unavailable</p><button onclick="window.location.reload()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded">Retry</button></div></div>';
        }
    }
}

// Load TradingView and initialize AAPL widget
document.addEventListener('DOMContentLoaded', function() {
    console.log('üìä Loading TradingView for AAPL market overview...');
    
    // Load TradingView script
    const script = document.createElement('script');
    script.src = 'https://s3.tradingview.com/tv.js';
    script.onload = function() {
        console.log('‚úÖ TradingView script loaded, initializing AAPL widget...');
        // Initialize widget after script loads
        setTimeout(() => {
            initAAPLTradingViewWidget();
        }, 1000);
    };
    script.onerror = function() {
        console.error('‚ùå Failed to load TradingView script');
        const container = document.getElementById('tradingview_aapl_chart');
        if (container) {
            container.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500"><div class="text-center"><i class="fas fa-exclamation-triangle text-4xl mb-4"></i><p>Unable to load market chart</p></div></div>';
        }
    };
    document.head.appendChild(script);
});
</script>
{% endblock %}
